import gspread
from oauth2client.service_account import ServiceAccountCredentials
from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.common.by import By
import time

# Set up Google Sheets API authentication
scope = ["https://spreadsheets.google.com/feeds", "https://www.googleapis.com/auth/drive"]
creds = ServiceAccountCredentials.from_json_keyfile_name('yourown.json', scope) #https://bit.ly/4dViiw6 how to get one
client = gspread.authorize(creds)

# Open the Google Sheet using its ID
spreadsheet_id = 'docs sheet'  # Extracted from your Google Sheets link
sheet = client.open_by_key(spreadsheet_id).sheet1  # Opening the first sheet
linkedin_links = sheet.col_values(1)  # Assuming LinkedIn links are in the first column

# Set up the webdriver (Make sure you have the appropriate ChromeDriver version installed)
service = Service('/usr/local/bin/chromedriver')
driver = webdriver.Chrome(service=service)

# Open LinkedIn and log in
driver.get('https://www.linkedin.com/login')
time.sleep(2)

# Enter your LinkedIn username and password
username = driver.find_element(By.ID, 'username')
username.send_keys('insert_your_email')  # Insert your email
password = driver.find_element(By.ID, 'password')
password.send_keys('insert_your_password')  # Insert your password

# Click the login button
login_button = driver.find_element(By.XPATH, '//*[@type="submit"]')
login_button.click()
time.sleep(3)

# Loop through the LinkedIn profile links and scrape data
for profile_url in linkedin_links:
    driver.get(profile_url)
    time.sleep(3)

    try:
        # Scrape name, headline, and company
        name = driver.find_element(By.XPATH, '//h1[@class="text-heading-xlarge inline t-24 v-align-middle break-words"]').text
        headline = driver.find_element(By.XPATH, '//div[@class="text-body-medium break-words"]').text
        company = driver.find_element(By.XPATH, '//button[@class="xRhPzpWKMomnMxYKhtpKBBcjqekJvFInLPlHw text-align-left"]').text


        print(f'Name: {name}')
        print(f'Headline: {headline}')
        print(f'Company: {company}')
    except Exception as e:
        print(f"Error scraping {profile_url}: {e}")

# Close the driver
driver.quit()
