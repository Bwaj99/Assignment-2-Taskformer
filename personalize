from openai import OpenAI
from os import getenv

# Initialize the OpenRouter API client using the environment variable for the API key
client = OpenAI(
    base_url="https://openrouter.ai/api/v1",
    api_key=getenv("OPENROUTER_API_KEY"),
)

def generate_message(profile_data):
    messages = []

    for _, profile in profile_data.iterrows():
        # Create the personalized prompt based on the profile data
        prompt = f"Write a personalized cold outreach message to {profile['Name']} who works at {profile['Company']} as {profile['Headline']}. The goal is to introduce Taskformer, a business automation tool, and schedule a demo."

        # Make a request to OpenRouter's API using the LLaMA model for completion
        response = client.chat.completions.create(
            model="meta-llama/llama-3-8b-instruct:free",  # Using LLaMA 8B model
            messages=[
                {
                    "role": "user",
                    "content": prompt,  # Sending the personalized prompt
                },
            ],
        )

        # Extract the generated message from the response
        personalized_message = response.choices[0].message.content.strip()
        messages.append(personalized_message)

    return messages

# Example usage
# Assuming profile_data is a pandas DataFrame containing LinkedIn profiles
# messages = generate_message(profile_data)
